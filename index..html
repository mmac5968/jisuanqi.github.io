<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>小米计算器 · 结果后完整显示过程（你最喜欢的尺寸）</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  :root{--bg:#f2f3f5;--panel:#fff;--text:#000;--text2:#888;--key:#fff;--key2:#e0e0e0;--orange:#ff9500;--orange-t:#fff}
  @media (prefers-color-scheme: dark){
    :root{--bg:#000;--panel:#1c1c1e;--text:#fff;--text2:#888;--key:#2c2c2e;--key2:#38383a}
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:-apple-system,"miui",sans-serif;background:var(--bg);height:100vh;display:flex;justify-content:center;align-items:center;overflow:hidden}
  .calculator{width:100%;max-width:400px;height:100vh;background:var(--panel);border-radius:36px;overflow:hidden;box-shadow:0 20px 50px rgba(0,0,0,.3);display:flex;flex-direction:column}
  .display{padding:40px 24px 20px;text-align:right;flex:1;overflow:hidden}
  .history{font-size:28px;color:var(--text2);line-height:1.4;opacity:0.85;word-break:break-all}
  .result{font-size:80px;font-weight:300;color:var(--text);line-height:1;word-break:break-all}
  .buttons{padding:10px 12px 30px;display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .btn{height:70px;border-radius:20px;font-size:32px;display:flex;align-items:center;justify-content:center;user-select:none;transition:.15s}
  .btn:active{transform:scale(.92)}
  .gray{background:var(--key2);color:#000}
  .orange{background:var(--orange);color:var(--orange-t)}
  .black{background:var(--key);color:var(--text)}
  .zero{grid-column:span 2;justify-content:flex-start;padding-left:28px}
</style>
</head>
<body>

<div class="calculator">
  <div class="display">
    <div class="history" id="history"></div>
    <div class="result" id="result">0</div>
  </div>

  <div class="buttons">
    <div class="btn gray" onclick="clearAll()">C</div>
    <div class="btn gray" onclick="toggleSign()">+/-</div>
    <div class="btn gray" onclick="percent()">%</div>
    <div class="btn orange" onclick="inputOp('÷')">÷</div>

    <div class="btn black" onclick="inputNum('7')">7</div>
    <div class="btn black" onclick="inputNum('8')">8</div>
    <div class="btn black" onclick="inputNum('9')">9</div>
    <div class="btn orange" onclick="inputOp('×')">×</div>

    <div class="btn black" onclick="inputNum('4')">4</div>
    <div class="btn black" onclick="inputNum('5')">5</div>
    <div class="btn black" onclick="inputNum('6')">6</div>
    <div class="btn orange" onclick="inputOp('-')">-</div>

    <div class="btn black" onclick="inputNum('1')">1</div>
    <div class="btn black" onclick="inputNum('2')">2</div>
    <div class="btn black" onclick="inputNum('3')">3</div>
    <div class="btn orange" onclick="inputOp('+')">+</div>

    <div class="btn black zero" onclick="inputNum('0')">0</div>
    <div class="btn black" onclick="inputDot()">.</div>
    <div class="btn orange" onclick="equal()">=</div>
  </div>
</div>

<script>
// 完全按照小米原生逻辑：输入过程 + 等号 + 结果一起显示在上方
let currentInput = '0';      // 当前输入的数字
let previous = null;         // 上一个运算数
let operator = null;         // 当前运算符
let fullExpression = '';     // 完整表达式（用于上方显示）

const resultEl = document.getElementById('result');
const historyEl = document.getElementById('history');

function updateDisplay() {
  resultEl.textContent = currentInput;
  historyEl.textContent = fullExpression;
}

function inputNum(num) {
  currentInput = currentInput === '0' ? num : currentInput + num;
  fullExpression = fullExpression.replace(/=$[\s\S]*/, '') + currentInput;
  updateDisplay();
}

function inputDot() {
  if (!currentInput.includes('.')) currentInput += '.';
  fullExpression = fullExpression.replace(/=$[\s\S]*/, '') + currentInput;
  updateDisplay();
}

function inputOp(op) {
  if (previous === null) {
    previous = parseFloat(currentInput);
    fullExpression = currentInput + ' ' + op + ' ';
  } else if (operator) {
    equal(); // 支持连续运算
    previous = parseFloat(currentInput);
    fullExpression = currentInput + ' ' + op + ' ';
  } else {
    fullExpression += ' ' + op + ' ';
  }
  operator = op;
  currentInput = '0';
  updateDisplay();
}

function equal() {
  if (!operator || previous === null) return;
  const second = parseFloat(currentInput);
  let result;
  if (operator === '+') result = previous + second;
  else if (operator === '-') result = previous - second;
  else if (operator === '×') result = previous * second;
  else if (operator === '÷') result = second === 0 ? '错误' : previous / second;

  // 关键：完整显示 88 × 88 = 7744
  fullExpression = previous + ' ' + operator + ' ' + second + ' =';
  currentInput = result === '错误' ? '错误' : Number(result.toFixed(10)) + '';

  previous = null;
  operator = null;
  updateDisplay();
}

function clearAll() {
  currentInput = '0';
  previous = null;
  operator = null;
  fullExpression = '';
  updateDisplay();
}

function toggleSign() {
  currentInput = (parseFloat(currentInput) * -1) + '';
  fullExpression = fullExpression.replace(/[\d\.\-]+$/, currentInput);
  updateDisplay();
}

function percent() {
  currentInput = (parseFloat(currentInput) / 100) + '';
  fullExpression = fullExpression.replace(/[\d\.\-]+$/, currentInput);
  updateDisplay();
}

updateDisplay();
</script>
</body>
</html>